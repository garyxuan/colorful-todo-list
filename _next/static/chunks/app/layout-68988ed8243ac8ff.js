(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{6799:function(e,t,r){Promise.resolve().then(r.bind(r,4873)),Promise.resolve().then(r.t.bind(r,8313,23)),Promise.resolve().then(r.t.bind(r,7960,23))},1088:function(e,t,r){"use strict";r.d(t,{C:function(){return i},O:function(){return c}});var a=r(7437),o=r(2265),n=r(4963);let l={startColor:"#F0E6FA",endColor:"#E0F2FE"},s=(0,o.createContext)({isLoggedIn:!1,userEmail:null,lastSync:null,isLoading:!1,autoSync:!0,preferences:l,login:async()=>{},logout:()=>{},syncTodos:async()=>[],updatePreferences:async()=>{},setAutoSync:()=>{},handleLoginSuccess:()=>{}});function c(e){let{children:t}=e,[r,c]=(0,o.useState)(!1),[i,u]=(0,o.useState)(null),[S,f]=(0,o.useState)(null),[g,y]=(0,o.useState)(!1),[m,d]=(0,o.useState)(null),[h,p]=(0,o.useState)(!0),[w,k]=(0,o.useState)(l);(0,o.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("userEmail"),r=localStorage.getItem("lastSync"),a=localStorage.getItem("autoSync"),o=localStorage.getItem("preferences");e&&t&&(d(e),u(t),c(!0),r&&f(new Date(r)),o&&k(JSON.parse(o))),null!==a&&p("true"===a)},[]);let I=(0,o.useCallback)(()=>{d(null),u(null),f(null),c(!1),k(l),localStorage.removeItem("token"),localStorage.removeItem("userEmail"),localStorage.removeItem("lastSync"),localStorage.removeItem("preferences")},[]),C=(0,o.useCallback)(async e=>{try{localStorage.setItem("token",e),d(e);let t=await fetch("".concat(n.C,"/auth/me"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok)throw Error("获取用户信息失败");let r=await t.json();u(r.email),f(new Date(r.lastSync)),k(r.preferences||l),c(!0),localStorage.setItem("userEmail",r.email),localStorage.setItem("lastSync",r.lastSync),localStorage.setItem("preferences",JSON.stringify(r.preferences||l))}catch(e){throw console.error("Login error:",e),I(),e}},[I]),E=(0,o.useCallback)(()=>{I()},[I]),_=(0,o.useCallback)(async e=>{y(!0);try{let t=await fetch("".concat(n.C,"/auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,preferences:w})});if(!t.ok)throw Error("登录失败");let r=await t.json();d(r.token),u(r.user.email),f(new Date(r.user.lastSync));let a=r.user.preferences||w;k(a),c(!0),localStorage.setItem("token",r.token),localStorage.setItem("userEmail",r.user.email),localStorage.setItem("lastSync",r.user.lastSync),localStorage.setItem("preferences",JSON.stringify(a))}catch(e){throw console.error("Login error:",e),e}finally{y(!1)}},[w]),b=(0,o.useCallback)(async e=>{if(!m||!r){k(e),localStorage.setItem("preferences",JSON.stringify(e));return}y(!0);try{let t=await fetch("".concat(n.C,"/preferences"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(m)},body:JSON.stringify({preferences:e})});if(!t.ok)throw Error("更新偏好设置失败");let r=(await t.json()).preferences||e;k(r),localStorage.setItem("preferences",JSON.stringify(r))}catch(t){throw console.error("Update preferences error:",t),k(e),localStorage.setItem("preferences",JSON.stringify(e)),t}finally{y(!1)}},[m,r]),O=(0,o.useCallback)(async e=>{if(!m||!r)return e;y(!0);try{if(0===e.length){let e=await fetch("".concat(n.C,"/todos"),{headers:{Authorization:"Bearer ".concat(m),"Content-Type":"application/json"}});if(!e.ok)throw Error("获取云端数据失败");let t=await e.json();return f(new Date),localStorage.setItem("lastSync",new Date().toISOString()),t.todos}{let t=await fetch("".concat(n.C,"/todos"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(m)},body:JSON.stringify({todos:e})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.details||"同步失败")}return f(new Date),localStorage.setItem("lastSync",new Date().toISOString()),e}}catch(e){throw console.error("Sync error:",e instanceof Error?e.message:e),e instanceof Error&&e.stack&&console.error("Stack trace:",e.stack),e}finally{y(!1)}},[m,r]);return(0,a.jsx)(s.Provider,{value:{isLoggedIn:r,userEmail:i,lastSync:S,isLoading:g,preferences:w,login:_,logout:E,syncTodos:O,updatePreferences:b,autoSync:h,setAutoSync:e=>{p(e),localStorage.setItem("autoSync",String(e))},handleLoginSuccess:C},children:t})}let i=()=>(0,o.useContext)(s)},4873:function(e,t,r){"use strict";r.d(t,{Providers:function(){return n}});var a=r(7437),o=r(1088);function n(e){let{children:t}=e;return(0,a.jsx)(o.O,{children:t})}},4963:function(e,t,r){"use strict";r.d(t,{C:function(){return a}});let a=(window.location.hostname.includes("github.io"),"https://colorful-todo-list-kappa.vercel.app/api")},7960:function(){},8313:function(e){e.exports={style:{fontFamily:"'__GeistSans_ded60d', '__GeistSans_Fallback_ded60d'"},className:"__className_ded60d",variable:"__variable_ded60d"}}},function(e){e.O(0,[630,971,117,744],function(){return e(e.s=6799)}),_N_E=e.O()}]);